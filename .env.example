# Autonomous Personal Assistant - Environment Configuration
# Copy this file to .env and fill in your actual values

# ============================================================================
# API KEYS
# ============================================================================

# Anthropic API - Get from: https://console.anthropic.com/
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxx

# Model selection
ROUTER_MODEL=claude-haiku-4-20250514
SIMPLE_AGENT_MODEL=claude-haiku-4-20250514
COMPLEX_AGENT_MODEL=claude-sonnet-4-20250514

# OpenAI API - Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxx
JUDGE_MODEL=gpt-4o-mini-2024-07-18
EMBEDDING_MODEL=text-embedding-3-small

# ============================================================================
# DATABASE - PostgreSQL
# ============================================================================

# PostgreSQL connection
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=assistant
POSTGRES_USER=assistant
POSTGRES_PASSWORD=your_secure_password_here

# Connection pool settings
POSTGRES_MIN_POOL_SIZE=5
POSTGRES_MAX_POOL_SIZE=20

# ============================================================================
# CACHE - Redis
# ============================================================================

# Redis connection
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=  # Optional, leave blank if no password
REDIS_DB=0

# Cache TTLs (in seconds)
EMBEDDING_CACHE_TTL=3600      # 1 hour
MEMORY_CACHE_TTL=1800         # 30 minutes
ROUTE_CACHE_TTL=3600          # 1 hour

# ============================================================================
# TWILIO - SMS Integration
# ============================================================================

# Get from: https://console.twilio.com/
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=xxxxxxxxxxxxxxxxxxxxx
TWILIO_PHONE_NUMBER=+1234567890
USER_PHONE_NUMBER=+1234567890

# ============================================================================
# DISCORD - Bot Integration
# ============================================================================

# Get from: https://discord.com/developers/applications
DISCORD_BOT_TOKEN=xxxxxxxxxxxxxxxxxxxxx
DISCORD_USER_ID=xxxxxxxxxxxxxxxxxxxxx
DISCORD_NOTIFICATION_CHANNEL_ID=xxxxxxxxxxxxxxxxxxxxx

# ============================================================================
# MEMORY SYSTEM - Configuration
# ============================================================================

# Retrieval configuration
INITIAL_RETRIEVAL_K=20        # Candidates for re-ranking
FINAL_RETRIEVAL_K=5           # Final memories to return
MIN_RETRIEVAL_IMPORTANCE=5.0  # Minimum importance to retrieve

# Consolidation configuration
CONSOLIDATION_INTERVAL_MINUTES=120   # How often to consolidate
MIN_IDLE_TIME_SECONDS=300            # Minimum idle before consolidation
PRUNING_SCHEDULE_HOUR=3              # When to run daily pruning (0-23)

# Deduplication
SIMILARITY_THRESHOLD=0.92      # Very similar (auto-merge)
MERGE_THRESHOLD=0.85           # Similar enough to cluster
RUN_DEDUPLICATION=true         # Enable automatic deduplication

# Memory limits and pruning
MAX_MEMORIES_PER_USER=10000
MEMORY_PRUNING_ENABLED=true
PRUNE_IMPORTANCE_THRESHOLD=3.0
PRUNE_DAYS_INACTIVE=30

# ============================================================================
# BACKUPS - S3-Compatible Storage
# ============================================================================

# S3 configuration (works with Backblaze B2, AWS S3, MinIO, etc.)
# For Backblaze B2:
S3_ENDPOINT=https://s3.us-west-000.backblazeb2.com
S3_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxxx
S3_SECRET_KEY=xxxxxxxxxxxxxxxxxxxxx
S3_BUCKET=assistant-backups
S3_REGION=us-west-000

# Backup schedule
BACKUP_ENABLED=true
BACKUP_SCHEDULE_HOUR=3         # When to run daily backup (0-23)
BACKUP_RETENTION_DAYS=30       # How long to keep backups

# ============================================================================
# SECURITY
# ============================================================================

# PII Detection
PII_DETECTION_ENABLED=true
PII_AUTO_REDACT=false          # Just warn, don't auto-redact
PII_TYPES_TO_DETECT=CREDIT_CARD,US_SSN,PHONE_NUMBER,EMAIL_ADDRESS

# Encryption
ENCRYPTION_ENABLED=false       # Set true for production
ENCRYPTION_KEY=                # Generate with: openssl rand -base64 32

# Rate limiting
RATE_LIMIT_ENABLED=true
SMS_RATE_LIMIT_PER_HOUR=20
DISCORD_RATE_LIMIT_PER_MINUTE=10
API_RATE_LIMIT_PER_MINUTE=60

# ============================================================================
# MONITORING
# ============================================================================

# Sentry error tracking - Get from: https://sentry.io/
SENTRY_DSN=https://xxxxxxxxxxxxxxxxxxxxx@sentry.io/xxxxxxxxxxxxxxxxxxxxx
SENTRY_ENVIRONMENT=production

# Prometheus metrics
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=8001

# Cost tracking
COST_TRACKING_ENABLED=true
DAILY_BUDGET_USD=5.00          # Alert if daily costs exceed this
WARN_AT_PERCENT=80             # Warn at 80% of budget

# ============================================================================
# OBSIDIAN - Git-Based Sync
# ============================================================================

# Path to your Obsidian vault
OBSIDIAN_VAULT_PATH=./obsidian_vault

# Git remote URL
OBSIDIAN_GIT_REMOTE=https://github.com/yourusername/vault.git
OBSIDIAN_GIT_BRANCH=main

# Sync configuration
OBSIDIAN_SYNC_ENABLED=true
OBSIDIAN_NOTIFY_ON_SYNC=true

# ============================================================================
# SYSTEM
# ============================================================================

# Logging
LOG_LEVEL=INFO                 # DEBUG, INFO, WARNING, ERROR, CRITICAL
DEBUG_MODE=false

# Server
HOST=0.0.0.0
PORT=8000
BASE_URL=https://yourdomain.com

# Worker configuration
WORKER_THREADS=4
MAX_CONCURRENT_REQUESTS=10

# ============================================================================
# DEVELOPMENT SETTINGS
# ============================================================================

# For local development with ngrok:
# 1. Start ngrok: ngrok http 8000
# 2. Copy the https URL to BASE_URL
# 3. Set DEBUG_MODE=true for verbose logs
# 4. Lower CONSOLIDATION_INTERVAL_MINUTES for faster testing

# Example development overrides:
# DEBUG_MODE=true
# LOG_LEVEL=DEBUG
# CONSOLIDATION_INTERVAL_MINUTES=5
# BASE_URL=https://abc123.ngrok.io

# ============================================================================
# PRODUCTION CHECKLIST
# ============================================================================

# Before deploying to production:
# ✓ Change POSTGRES_PASSWORD to a strong random password
# ✓ Set ENCRYPTION_ENABLED=true and generate ENCRYPTION_KEY
# ✓ Update BASE_URL to your actual domain
# ✓ Set DEBUG_MODE=false
# ✓ Configure SENTRY_DSN for error tracking
# ✓ Set up S3 backups with correct credentials
# ✓ Test backup and restore procedure
# ✓ Configure rate limits appropriately
# ✓ Set DAILY_BUDGET_USD to your actual budget
# ✓ Never commit .env to git (it's in .gitignore)

# ============================================================================
# COST OPTIMIZATION TIPS
# ============================================================================

# To minimize costs:
# - Router uses Haiku (cheap) to classify all messages
# - 80% of messages should route to Haiku (very cheap)
# - 15% to Sonnet (expensive but necessary)
# - 5% to Sonnet with tools
# - Enable caching (EMBEDDING_CACHE_TTL, ROUTE_CACHE_TTL)
# - Monitor with cost tracker dashboard

# Expected costs at 50 messages/day: ~$1.87/month
# Expected costs at 100 messages/day: ~$3.12/month

# ============================================================================
# NOTES
# ============================================================================

# Phone Numbers:
# - Use E.164 format: +[country code][number]
# - Example: +1234567890 for US numbers

# Database:
# - PostgreSQL stores everything (vectors + metadata)
# - Redis caches hot data for speed
# - Both run via Docker Compose

# Backups:
# - Daily backups to S3 at BACKUP_SCHEDULE_HOUR
# - Retention is BACKUP_RETENTION_DAYS
# - Test restore before relying on backups

# Security:
# - PII detection flags sensitive data
# - Encryption at rest optional (enable for production)
# - Rate limiting prevents abuse
# - Never expose API keys

# Monitoring:
# - Prometheus metrics on port 8001
# - Grafana dashboards for visualization
# - Sentry for error tracking
# - Cost tracker for budget alerts
